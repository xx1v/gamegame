(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[501],{1515:function(e,t,i){"use strict";i.d(t,{Fc:function(){return d},HH:function(){return o},II:function(){return v},Jq:function(){return s},Nw:function(){return r},SY:function(){return u},Xm:function(){return f},et:function(){return a},iI:function(){return c},jh:function(){return l},vI:function(){return p}});let n=(0,i(8508).oM)({name:"app-slice",initialState:{state:{type:"INITIAL"},token:null,isLoading:!1,locale:"ru",isUserDataSubmitting:!1,showHintPopover:!1},reducers:{onAppInitialize:(e,t)=>{let{payload:i}=t;e.token=i.token,e.locale=i.locale},onLoading:(e,t)=>{let{payload:i}=t;e.isLoading=i},onIntitializeComplite:(e,t)=>{let{payload:i}=t;e.response=i},onStepChange:(e,t)=>{let{payload:i}=t;e.state=i},onUserDeliveryInfoChange:(e,t)=>{let{payload:i}=t;e.userDeliveryInfo=i},onSubmitResponse:(e,t)=>{let{payload:i}=t;e.submitResponse=i},onUserRetry:e=>{e.response&&(e.response.details.err_msg=void 0,e.response.details.delivery_error=void 0)},onUserDataSubmiting:(e,t)=>{let{payload:i}=t;e.isUserDataSubmitting=i},onShowHintPopover:(e,t)=>{let{payload:i}=t;e.showHintPopover=i},onActionDueDateTimeout:e=>{}}}),r=n.actions,{onAppInitialize:o,onLoading:l,onIntitializeComplite:s,onStepChange:a,onUserDeliveryInfoChange:d,onSubmitResponse:u,onUserRetry:c,onUserDataSubmiting:p,onShowHintPopover:f,onActionDueDateTimeout:v}=n.actions;t.ZP=n.reducer},8514:function(e,t,i){"use strict";i.d(t,{h:function(){return R},CG:function(){return I},bO:function(){return w}});var n=i(3338),r=i(8508),o=i(828),l=i(1515),s=i(9890),a=i(6183);let d={onStatusUpdate:async(e,t)=>await fetch("/api/status?token=".concat(e),{method:"GET",headers:{"Content-Type":"application/json","Accept-Language":t}}).then(e=>{if(!e.ok)throw Error("HTTP FETCH FAILED");return e.text()}).then(e=>(0,a.$)(e)).catch(e=>{console.error(e)}),onUserDeliveryInfoSubmit:async(e,t,i,n)=>await fetch("/api/submit?token=".concat(e),{method:"POST",body:JSON.stringify({recipient_url:t,recipient_country_code:n}),headers:{"Content-Type":"application/json","Accept-Language":i}}).then(async e=>{if(!e.ok)throw Error("HTTP FETCH FAILED");return 204!==e.status?{statusCode:e.status,response:await e.json()}:{statusCode:e.status}}).catch(e=>{console.error(e)})};var u=i(6288);let c="Something went wrong...";function*p(e){switch(e){case"process_user_link":yield(0,s.gz)((0,l.et)({type:"PROCESS_USER_LINK"}));break;case"waiting_for_friend_request_confirmation":yield(0,s.gz)((0,l.et)({type:"WAITING_FOR_FRIEND_REQUEST_CONFIRMATION"}));break;case"process_gift_purchase":yield(0,s.gz)((0,l.et)({type:"PROCESS_GIFT_PURCHASE"}));break;case"awaiting_sender":yield(0,s.gz)((0,l.et)({type:"AWAITING_SENDER"}));break;default:yield(0,s.gz)((0,l.et)({type:"PANIC"}))}}function*f(){return yield(0,s.Ys)(e=>e.appReducer)}function*v(e){u.A.error(null!=e?e:c),yield(0,s.gz)((0,l.et)({type:"RETRY"})),yield(0,s.qn)(l.Nw.onUserRetry.type)}function*y(e){u.A.error(null!=e?e:c),yield(0,s.gz)((0,l.et)({type:"GET_USER_INFO"}));let{timeout:t}=yield(0,s.S3)({userInput:(0,s.qn)(l.Nw.onUserRetry.type),timeout:(0,s.qn)(l.Nw.onActionDueDateTimeout.type)});t&&(yield(0,s.RE)(h))}function*_(e,t){u.A.error(null!=t?t:c),yield(0,s.gz)((0,l.et)(e))}function*g(e){var t,i,n,r,o,a;yield(0,s.gz)((0,l.et)({type:"GET_USER_INFO"})),yield(0,s.qn)(l.Nw.onUserDeliveryInfoChange.type);let c=yield(0,s.RE)(f);yield(0,s.gz)((0,l.vI)(!0));let p=yield(0,s.RE)(d.onUserDeliveryInfoSubmit,c.token,null===(t=c.userDeliveryInfo)||void 0===t?void 0:t.steamUrl,c.locale,e?void 0:null===(i=c.userDeliveryInfo)||void 0===i?void 0:i.region);yield(0,s.gz)((0,l.SY)(p));let v=yield(0,s.Ys)(e=>e.appReducer.submitResponse),y=null==v?void 0:null===(n=v.response)||void 0===n?void 0:n.code;if(y&&0!==y){yield(0,s.gz)((0,l.et)({type:"GET_USER_INFO"}));let e=null===(o=v.response)||void 0===o?void 0:null===(r=o.error_details)||void 0===r?void 0:r.error_message,t=null===(a=v.response)||void 0===a?void 0:a.error_message,i=e||t;i&&u.A.error(i),yield(0,s.gz)((0,l.vI)(!1))}else v&&(204===v.statusCode&&(yield(0,s.RE)(h,5e3),yield(0,s.gz)((0,l.vI)(!1))),409===v.statusCode&&(yield(0,s.gz)((0,l.vI)(!1)),yield(0,s.RE)(h)))}let m=e=>{if(e){localStorage.setItem("savedData",JSON.stringify(e));return}{let e=localStorage.getItem("savedData");if(e)return JSON.parse(e)}};function*h(e){e&&(yield(0,s.gw)(e));let t=yield(0,s.Ys)(e=>e.appReducer.token),i=yield(0,s.Ys)(e=>e.appReducer.locale);if(yield(0,s.gz)((0,l.jh)(!0)),t){var n,r,o,a,u,c;let e=yield(0,s.RE)(d.onStatusUpdate,t,i),p=m(),f=null!==(a=e.details.due_date)&&void 0!==a?a:null==p?void 0:null===(n=p.response)||void 0===n?void 0:n.details.due_date,v=null!==(u=e.details.allow_regular_links)&&void 0!==u?u:null==p?void 0:null===(r=p.response)||void 0===r?void 0:r.details.allow_regular_links,y=null!==(c=e.details.available_regions)&&void 0!==c?c:null==p?void 0:null===(o=p.response)||void 0===o?void 0:o.details.available_regions,_=e.details.sender_steam_id64?String(e.details.sender_steam_id64):void 0,g=e.details.recipient_steam_id64?String(e.details.recipient_steam_id64):void 0;yield(0,s.gz)((0,l.Jq)({...e,details:{...e.details,due_date:f,allow_regular_links:v,available_regions:y,sender_steam_id64:_,recipient_steam_id64:g}}))}yield(0,s.gz)((0,l.jh)(!1))}let E=(0,n.ZP)(),R=(0,r.xC)({devTools:!0,reducer:{appReducer:l.ZP},middleware:e=>e({thunk:!1}).concat(E)});E.run(function*(){yield(0,s.qn)(l.Nw.onAppInitialize.type);let e=!0,t=!1,i=!0;for(;;){var n,r,o,a,d,c,E,R,w,I,N,b,S;if(e||t){if(yield(0,s.RE)(h),e){let t=yield(0,s.RE)(f);(null===(c=t.response)||void 0===c?void 0:c.details.allow_regular_links)!==void 0&&t.response.details.due_date&&m(t),e=!1}t&&(t=!1);continue}let T=yield(0,s.RE)(f),k=null===(n=T.response)||void 0===n?void 0:n.details.delivered,z=null===(r=T.response)||void 0===r?void 0:r.details.in_progress,C=null===(o=T.response)||void 0===o?void 0:o.details.delivery_error;if((null===(a=T.response)||void 0===a?void 0:a.details.notify_sender_changed)&&i&&(u.A.error("отправитель изменился и запрос на добавление в друзья будет отправлен повторно."),yield(0,s.gz)((0,l.et)({type:"SENDER_CHANGED"})),i=!1),k){yield(0,s.gz)((0,l.et)({type:"DELIVERED"}));return}if(z){let e=null===(E=T.response)||void 0===E?void 0:E.details.processing_step;e&&(yield(0,s.RE)(p,e)),yield(0,s.RE)(h,3e3);continue}if((null===(d=T.response)||void 0===d?void 0:d.details.delivery_allowed)&&!T.response.details.in_progress){if(C){if("invalid_identifier"===C)yield(0,s.RE)(y,null===(R=T.response)||void 0===R?void 0:R.details.err_msg);else{yield(0,s.RE)(v,null===(w=T.response)||void 0===w?void 0:w.details.err_msg);continue}}yield(0,s.RE)(g)}else{if(C){switch(null===(I=T.response)||void 0===I?void 0:I.details.required_action){case"friend_request_confirmation":yield(0,s.RE)(_,{type:"WAITING_FOR_FRIEND_REQUEST_CONFIRMATION"},null===(N=T.response)||void 0===N?void 0:N.details.err_msg);break;case"recipient_url_confirmation":break;case"recipient_url_required":u.A.error(null===(b=T.response)||void 0===b?void 0:b.details.err_msg),yield(0,s.RE)(g,!0),t=!0;break;default:yield(0,s.RE)(_,{type:"ERROR"},null===(S=T.response)||void 0===S?void 0:S.details.err_msg);return}continue}yield(0,s.RE)(l.et,{type:"PANIC"});return}}});let w=()=>(0,o.I0)(),I=o.v9},4819:function(e,t,i){"use strict";i.d(t,{dV:function(){return n}});let n=e=>{let t=new Date(e.replace(/\s[A-Z]{3}$/,"").split(" ").filter(e=>!e.includes("+")||e.includes("-")).join(" "));return isNaN(t.getTime())?0:t.getTime()}},6401:function(e,t,i){"use strict";var n=i(7437),r=i(2169),o=i(7742);i(2265);var l=i(4548),s=i.n(l),a=i(9580);let d=(0,o.j)("inline-flex items-center justify-center rounded-[40px] h-[40px] disabled:opacity-50 md:h-[62px] font-bold text-xs md:text-base transition-opacity duration-300",{variants:{variant:{default:(0,r.cn)(s().gradientButton,"hover:text-green-custom transition-colors"),solid:"bg-green-custom",white:""},size:{default:"px-5 py-1 w-full",small:"pr-[50px] pl-[35px] py-2 w-auto"}},defaultVariants:{variant:"default",size:"default"}}),u=e=>{let{className:t,isLoading:i,variant:o,size:l,disabled:u,children:c,...p}=e;return(0,n.jsxs)("button",{className:(0,r.cn)("flex gap-2.5",d({className:t,variant:o,size:l})),...p,disabled:i||u,children:[(0,n.jsx)("div",{className:"relative",children:c}),i?(0,n.jsx)(a.Z,{className:"w-5 h-5 animate-spin"}):(0,n.jsxs)("svg",{className:s().arrow,width:"16",height:"14",viewBox:"0 0 16 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,n.jsx)("path",{d:"M9.5 12L14.5 7L9.5 2",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),(0,n.jsx)("path",{className:s().arrowPath,d:"M2 6C1.44772 6 1 6.44772 1 7C1 7.55229 1.44772 8 2 8L2 6ZM14 6L2 6L2 8L14 8L14 6Z",fill:"currentColor"})]})]})};u.displayName="Button",t.Z=u},2193:function(e,t,i){"use strict";i.d(t,{Lj:function(){return d},Yi:function(){return a},bZ:function(){return u},zs:function(){return s}});var n=i(7437),r=i(2265),o=i(6725),l=i(2169);let s=o.fC,a=o.xz,d=o.Eh,u=r.forwardRef((e,t)=>{let{className:i,align:r="center",sideOffset:s=4,...a}=e;return(0,n.jsx)(o.VY,{ref:t,align:r,sideOffset:s,className:(0,l.cn)("z-50 w-64 rounded-md border bg-white text-black-200 p-6 shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",i),...a})});u.displayName=o.VY.displayName},2169:function(e,t,i){"use strict";i.d(t,{cn:function(){return o}});var n=i(3167),r=i(1367);function o(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return(0,r.m6)((0,n.Z)(t))}},7791:function(e,t,i){"use strict";i.d(t,{IT:function(){return r},QT:function(){return n},Zt:function(){return l},e4:function(){return o},eV:function(){return s}});let{useI18n:n,useScopedI18n:r,I18nProviderClient:o,useChangeLocale:l,useCurrentLocale:s}=(0,i(8333).createI18nClient)({en:()=>i.e(401).then(i.bind(i,5401)),ru:()=>i.e(764).then(i.bind(i,1764))})},4548:function(e){e.exports={gradientButton:"Button_gradientButton__hTWAP",arrow:"Button_arrow__Pi_KL",arrowPath:"Button_arrowPath__vL_v8"}}}]);